/*! d3-funnel - v0.6.2 | 2015-02-04 */
!function(a){"use strict";function b(a){this.selector=a,this.defaults={width:350,height:400,bottomWidth:1/3,bottomPinch:0,isCurved:!1,curveHeight:20,fillType:"solid",isInverted:!1,hoverEffects:!1,dynamicArea:!1,label:{fontSize:"14px"}}}function c(a,b){var c=parseInt(a.slice(1),16),d=0>b?0:255,e=0>b?-1*b:b,f=c>>16,g=c>>8&255,h=255&c,i=16777216+65536*(Math.round((d-f)*e)+f)+256*(Math.round((d-g)*e)+g)+(Math.round((d-h)*e)+h);return"#"+i.toString(16).slice(1)}b.prototype._isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},b.prototype._extend=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},b.prototype.draw=function(a,b){this._initialize(a,b),d3.select(this.selector).selectAll("svg").remove();var c=d3.select(this.selector).append("svg").attr("width",this.width).attr("height",this.height).append("g"),d={},e={},f=this._makePaths();"gradient"===this.fillType&&this._defineColorGradients(c),this.isCurved&&this._drawTopOval(c,f);for(var g=0;g<f.length;g++){var h="gradient"!==this.fillType?this.data[g][2]:"url(#gradient-"+g+")";a={index:g,label:this.data[g][0],value:this.data[g][1],baseColor:this.data[g][2],fill:h};for(var i=f[g],j="",k=0;k<i.length;k++)e=i[k],j+=e[2]+e[0]+","+e[1]+" ";d=c.append("g"),e=d.append("path").attr("fill",h).attr("d",j).data([a]),this.hoverEffects&&e.on("mouseover",this._onMouseOver).on("mouseout",this._onMouseOut);var l=this.data[g][0]+": "+this.data[g][1].toLocaleString(),m=this.width/2,n=this.isCurved?(i[2][1]+i[3][1])/2+this.curveHeight/this.data.length:(i[1][1]+i[2][1])/2;d.append("text").text(l).attr({x:m,y:n,"text-anchor":"middle","dominant-baseline":"middle",fill:"#fff","pointer-events":"none"}).style("font-size",this.label.fontSize)}},b.prototype._initialize=function(a,b){if(!this._isArray(a)||0===a.length||!this._isArray(a[0])||a[0].length<2)throw{name:"D3 Funnel Data Error",message:"Funnel data is not valid."};b="undefined"!=typeof b?b:{},this.data=a;var c=0,d=this._extend({},this.defaults);d.width=parseInt(d3.select(this.selector).style("width"),10),d.height=parseInt(d3.select(this.selector).style("height"),10);var e=Object.keys(b);for(c=0;c<e.length;c++)"label"!==e[c]&&(d[e[c]]=b[e[c]]);"label"in b&&"fontSize"in b.label&&(d.label.fontSize=b.label.fontSize),this.label=d.label,d.width<=0&&(d.width=this.defaults.width),d.height<=0&&(d.height=this.defaults.height);var f=d3.scale.category10();for(c=0;c<this.data.length;c++){var g=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i;"undefined"!=typeof this.data[c][2]&&g.test(this.data[c][2])||(this.data[c][2]=f(c))}this.width=d.width,this.height=d.height,this.bottomWidth=d.width*d.bottomWidth,this.bottomPinch=d.bottomPinch,this.isCurved=d.isCurved,this.curveHeight=d.curveHeight,this.fillType=d.fillType,this.isInverted=d.isInverted,this.hoverEffects=d.hoverEffects,this.dynamicArea=d.dynamicArea,this.bottomLeftX=(this.width-this.bottomWidth)/2,this.dx=this.bottomPinch>0?this.bottomLeftX/(a.length-this.bottomPinch):this.bottomLeftX/a.length,this.dy=this.isCurved?(this.height-this.curveHeight)/a.length:this.height/a.length},b.prototype._makePaths=function(){var a=[],b=this.dx,c=this.dy,d=0,e=this.width,f=0;this.isInverted&&(d=this.bottomLeftX,e=this.width-this.bottomLeftX);var g=0,h=0,i=0,j=this.width/2;this.isCurved&&(f=10);for(var k=this.width,l=0,m=this.height*(this.width+this.bottomWidth)/2,n=2*this.height/(this.width-this.bottomWidth),o=0,p=0,q=0;q<this.data.length;q++)o+=this.data[q][1];for(q=0;q<this.data.length;q++){if(p=this.data[q][1],this.dynamicArea){var r=p/o,s=r*m;l=Math.sqrt((n*k*k-4*s)/n),b=k/2-l/2,c=2*s/(k+l),this.isCurved&&(c-=this.curveHeight/this.data.length),k=l}this.bottomPinch>0&&(this.isInverted?(this.dynamicArea||(b=this.dx),b=q<this.bottomPinch?0:b):q>=this.data.length-this.bottomPinch&&(b=0)),g=d+b,h=e-b,i=f+c,this.isInverted&&(g=d-b,h=e+b),a.push(this.isCurved?[[d,f,"M"],[j,f+(this.curveHeight-10),"Q"],[e,f,""],[h,i,"L"],[h,i,"M"],[j,i+this.curveHeight,"Q"],[g,i,""],[d,f,"L"]]:[[d,f,"M"],[e,f,"L"],[h,i,"L"],[g,i,"L"],[d,f,"L"]]),d=g,e=h,f=i}return a},b.prototype._defineColorGradients=function(a){for(var b=a.append("defs"),d=0;d<this.data.length;d++)for(var e=this.data[d][2],f=c(e,-.25),g=b.append("linearGradient").attr({id:"gradient-"+d}),h=[[0,f],[40,e],[60,e],[100,f]],i=0;i<h.length;i++){var j=h[i];g.append("stop").attr({offset:j[0]+"%",style:"stop-color:"+j[1]})}},b.prototype._drawTopOval=function(a,b){var d=0,e=this.width,f=this.width/2;this.isInverted&&(d=this.bottomLeftX,e=this.width-this.bottomLeftX);var g=b[0],h="M"+d+","+g[0][1]+" Q"+f+","+(g[1][1]+this.curveHeight-10)+" "+e+","+g[2][1]+" M"+e+",10 Q"+f+",0 "+d+",10";a.append("path").attr("fill",c(this.data[0][2],-.4)).attr("d",h)},b.prototype._onMouseOver=function(a){d3.select(this).attr("fill",c(a.baseColor,-.2))},b.prototype._onMouseOut=function(a){d3.select(this).attr("fill",a.fill)},a.D3Funnel=b}(this);